"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1521,2160,8306,3913,7073],{44541:(L,D,d)=>{var I,y;I=[d(27145),d(32230),d(22143),d(45482),d(47913),d(88186),d(98755),d(83713),d(38259),d(2585),d(98166),d(75203),d(62023),d(74344),d(31369),d(7927),d(85233),d(44882),d(7073),d(10577)],y=function(v,g,m,u,c,b,a,s,r,o,n,f,x,h,S,O,E,k,H,A){var i={active:void 0,posts:{},bsEnvironment:void 0,formatting:void 0};$(window).off("resize",J).on("resize",J),J(),$(window).on("action:composer.topics.post",function(e,t){localStorage.removeItem("category:"+t.data.cid+":bookmark"),localStorage.removeItem("category:"+t.data.cid+":bookmark:clicked")}),$(window).on("popstate",function(){var e=utils.findBootstrapEnvironment();if(i.active&&(e==="xs"||e==="sm")){if(!i.posts[i.active].modified){i.discard(i.active),i.discardConfirm&&i.discardConfirm.length&&(i.discardConfirm.modal("hide"),delete i.discardConfirm);return}g.translate("[[modules:composer.discard]]",function(t){i.discardConfirm=S.confirm(t,function(l){l?i.discard(i.active):i.posts[i.active].modified=!0}),i.posts[i.active].modified=!1})}});function j(){var e=i.bsEnvironment;(ajaxify.data.template.compose===!0||e==="xs"||e==="sm")&&history.back()}function J(){var e=utils.findBootstrapEnvironment(),t=e==="xs"||e==="sm";s.toggle&&(s.env!==e&&t&&(s.env=e,s.toggle(!1)),s.env=e),i.active!==void 0&&(r.reposition($('.composer[data-uuid="'+i.active+'"]')),!t&&window.location.pathname.startsWith(config.relative_path+"/compose")?history.back():t&&!window.location.pathname.startsWith(config.relative_path+"/compose")&&q()),i.bsEnvironment=e}function ne(e){var t,l;e.hasOwnProperty("cid")?t="cid":e.hasOwnProperty("tid")?t="tid":e.hasOwnProperty("pid")&&(t="pid"),l=e[t];for(var p in i.posts)if(i.posts[p].hasOwnProperty(t)&&l===i.posts[p][t])return p;return!1}function G(e){var t=utils.generateUUID(),l=ne(e);if(l)return v.updateActive(l),i.load(l);var p="[[topic:composer.new_topic]]";e.action==="posts.reply"?p="[[topic:composer.replying_to]]":e.action==="posts.edit"&&(p="[[topic:composer.editing]]"),g.translate(p,function(w){v.push("composer",t,{title:w.replace("%1",'"'+e.title+'"')})}),e.hasOwnProperty("cid")?e.save_id=["composer",app.user.uid,"cid",e.cid].join(":"):e.hasOwnProperty("tid")?e.save_id=["composer",app.user.uid,"tid",e.tid].join(":"):e.hasOwnProperty("pid")&&(e.save_id=["composer",app.user.uid,"pid",e.pid].join(":")),i.posts[t]=e,i.load(t)}async function F(e,t){$('.composer[data-uuid="'+e+'"]').find(".composer-submit").removeAttr("disabled");const{showAlert:l}=await E.fire("filter:composer.error",{post_uuid:e,message:t,showAlert:!0});l&&O.alert({type:"danger",timeout:1e4,title:"",message:t,alert_id:"post_error"})}i.findByTid=function(e){for(var t in i.posts)if(i.posts.hasOwnProperty(t)&&i.posts[t].hasOwnProperty("tid")&&parseInt(i.posts[t].tid,10)===parseInt(e,10))return t;return null},i.addButton=function(e,t,l){u.addButton(e,t,l)},i.newTopic=async e=>{var t={action:"topics.post",cid:e.cid,handle:e.handle,title:e.title||"",body:e.body||"",tags:e.tags||[],modified:!!(e.title&&e.title.length||e.body&&e.body.length),isMain:!0};({pushData:t}=await E.fire("filter:composer.topic.push",{data:e,pushData:t})),G(t)},i.addQuote=function(e,t,l,p,w,C,T){T=T||i.active;var N=(p||"").replace(/([\\`*_{}[\]()#+\-.!])/g,"\\$1").replace(/\[/g,"&#91;").replace(/\]/g,"&#93;").replace(/%/g,"&#37;").replace(/,/g,"&#44;");C&&(C="> "+C.replace(/\n/g,`
> `)+`

`);var U="["+N+"]("+config.relative_path+"/post/"+(l||t)+")";if(T===void 0){p&&(l||t)?i.newReply(e,t,p,"[[modules:composer.user_said_in, "+w+", "+U+`]]
`+C):i.newReply(e,t,p,"[[modules:composer.user_said, "+w+`]]
`+C);return}else T!==i.active&&i.load(T);var P=$('.composer[data-uuid="'+T+'"]'),R=P.find("textarea"),M=R.val();p&&(l||t)?g.translate("[[modules:composer.user_said_in, "+w+", "+U+`]]
`,config.defaultLang,W):g.translate("[[modules:composer.user_said, "+w+`]]
`,config.defaultLang,W);function W(B){i.posts[T].body=(M.length?M+`

`:"")+B+C,R.val(i.posts[T].body),Q(P),s.render(P)}},i.newReply=function(e,t,l,p){g.translate(p,config.defaultLang,function(w){G({action:"posts.reply",tid:e,toPid:t,title:l,body:w,modified:!!(l&&l.length||w&&w.length),isMain:!1})})},i.editPost=function(e){socket.emit("plugins.composer.push",e,function(t,l){if(t)return O.error(t);l.action="posts.edit",l.pid=e,l.modified=!1,G(l)})},i.load=function(e){var t=$('.composer[data-uuid="'+e+'"]');t.length?(Z(e),r.reposition(t),Q(t),ee()):i.formatting?X(e):socket.emit("plugins.composer.getFormattingOptions",function(l,p){if(l)return O.error(l);i.formatting=p,X(e)})},i.enhance=function(e,t,l){!t&&!l&&(t=utils.generateUUID(),i.posts[t]=ajaxify.data,l=ajaxify.data,e.attr("data-uuid",t));var p=e.find("textarea"),w=e.find(".composer-submit");a.init(e,i.posts[t]),n.init(e,i.posts),u.addHandler(e),u.addComposerButtons(),s.handleToggler(e),m.initialize(t),b.init(e,i.posts[t]),o.init(e,t),e.on("change","input, textarea",function(){i.posts[t].modified=!0,c.updateVisibility("available",i.posts[t].save_id,!0),c.updateVisibility("open",i.posts[t].save_id,!0)}),w.on("click",function(T){T.preventDefault(),T.stopPropagation(),$(this).attr("disabled",!0),_(t)}),d.e(2441).then(function(){var T=[d(42441)];(function(N){N(e.get(0)).bind("mod+enter",function(){w.attr("disabled",!0),_(t)})}).apply(null,T)}).catch(d.oe),e.find(".composer-discard").on("click",function(T){if(T.preventDefault(),!i.posts[t].modified)return i.discard(t),j();u.exitFullscreen();var N=$(this).prop("disabled",!0);g.translate("[[modules:composer.discard]]",function(U){S.confirm(U,function(P){P&&(i.discard(t),j()),N.prop("disabled",!1)})})}),e.find(".composer-minimize, .minimize .trigger").on("click",function(T){T.preventDefault(),T.stopPropagation(),i.minimize(t)}),p.on("input propertychange",utils.debounce(function(){s.render(e)},250)),p.on("scroll",function(){s.matchScroll(e)}),c.init(e,l);const C=c.get(l.save_id);s.render(e,function(){s.matchScroll(e)}),ae(e),se(e),Q(e),l.action==="posts.edit"&&i.updateThumbCount(t,e),A.isEnabled||$('[data-format="zen"]').addClass("hidden"),E.fire("action:composer.enhanced",{postContainer:e,postData:l,draft:C})};async function oe(e){return ajaxify.data.template.category?ajaxify.data:parseInt(e.cid,10)?await h.get(`/api/category/${e.cid}`,{}):null}async function X(e){var t=i.posts[e],l=t?t.hasOwnProperty("cid"):!1,p=t?!!t.isMain:!1,w=t?!!t.pid:!1,C=t?parseInt(t.uid,10)===0:!1;const T=t.timestamp>Date.now();var N=t.title.replace(/%/g,"&#37;").replace(/,/g,"&#44;");t.category=await oe(t);const U=t.category?t.category.privileges:ajaxify.data.privileges;var P={title:N,titleLength:N.length,body:t.body,mobile:i.bsEnvironment==="xs"||i.bsEnvironment==="sm",resizable:!0,thumb:t.thumb,isTopicOrMain:l||p,maximumTitleLength:config.maximumTitleLength,maximumPostLength:config.maximumPostLength,minimumTagLength:config.minimumTagLength,maximumTagLength:config.maximumTagLength,isTopic:l,isEditing:w,canSchedule:!!(p&&U&&(U["topics:schedule"]&&!w||T&&U.view_scheduled)),showHandleInput:config.allowGuestHandles&&(app.user.uid===0||w&&C&&app.user.isAdmin),handle:t?t.handle||"":void 0,formatting:i.formatting,tagWhitelist:t.category?t.category.tagWhitelist:ajaxify.data.tagWhitelist,privileges:app.user.privileges,selectedCategory:t.category,submitOptions:[]};P.mobile&&(q(),app.toggleNavbar(!1)),t.mobile=i.bsEnvironment==="xs"||i.bsEnvironment==="sm",{postData:t,createData:P}=await E.fire("filter:composer.create",{postData:t,createData:P}),app.parseAndTranslate("composer",P,function(R){if(!$('.composer.composer[data-uuid="'+e+'"]').length){R=$(R),R.find(".title").each(function(){$(this).text(g.unescape($(this).text()))}),R.attr("data-uuid",e),$(document.body).append(R);var M=$(R[0]);if(r.reposition(M),i.enhance(M,e,t),Z(e),M.on("click",function(){v.isActive(e)||v.updateActive(e)}),r.handleResize(M),i.bsEnvironment==="xs"||i.bsEnvironment==="sm"){var W=M.find(".composer-submit"),B=M.find(".mobile-navbar .composer-submit"),Y=M.find(".write"),K=Y.attr("tabindex");W.removeAttr("tabindex"),B.attr("tabindex",parseInt(K,10)+1),$(".category-name-container").on("click",function(){$(".category-selector").toggleClass("open")})}$(window).trigger("action:composer.loaded",{postContainer:M,post_uuid:e,composerData:i.posts[e],formatting:i.formatting}),f.apply(M.find(".write")),Q(M),ee()}})}function q(){var e="compose?p="+window.location.pathname,t=window.location.pathname.slice(1)+window.location.search;t.startsWith(config.relative_path.slice(1))&&(t=t.slice(config.relative_path.length)),window.history.replaceState({url:null,returnPath:t},t,config.relative_path+"/"+t),window.history.pushState({url:e},e,`${config.relative_path}/${t}`)}function ae(e){var t=e.find(".help");socket.emit("plugins.composer.renderHelp",function(l,p){!l&&p&&p.length>0&&(t.removeClass("hidden"),t.on("click",function(){S.alert(p)}))})}function se(e){var t=e.attr("data-uuid"),l=i.posts[t]&&i.posts[t].action==="posts.edit",p=utils.findBootstrapEnvironment(),w=p==="xs"||p==="sm";l||w||H.enableQuickSearch({searchElements:{inputEl:e.find("input.title"),resultEl:e.find(".quick-search-container")},hideOnNoMatches:!0})}function Z(e){i.active&&i.active!==e&&i.minimize(i.active),i.active=e,$(window).trigger("action:composer.activate",{post_uuid:e})}function Q(e){setTimeout(function(){var t=e.find("input.title");t.length?t.focus():e.find("textarea").focus().putCursorAtEnd()},20)}async function _(e){var t=i.posts[e],l=$('.composer[data-uuid="'+e+'"]'),p=l.find(".handle"),w=l.find(".title"),C=l.find("textarea"),T=l.find("input#topic-thumb-url"),N=t.hasOwnProperty("template")&&t.template.compose===!0;const U=l.find(".composer-submit");w.val(w.val().trim()),C.val(utils.rtrim(C.val())),T.length&&T.val(T.val().trim());var P=t.action,R=(t.hasOwnProperty("cid")||parseInt(t.pid,10))&&l.find("input.title").length,M=!R||R&&parseInt(t.cid,10),W={post_uuid:e,postData:t,postContainer:l,titleEl:w,titleLen:w.val().length,bodyEl:C,bodyLen:C.val().length};if(await E.fire("filter:composer.check",W),$(window).trigger("action:composer.check",W),W.error)return F(e,W.error);if(m.inProgress[e]&&m.inProgress[e].length)return F(e,"[[error:still-uploading]]");if(R&&W.titleLen<parseInt(config.minimumTitleLength,10))return F(e,"[[error:title-too-short, "+config.minimumTitleLength+"]]");if(R&&W.titleLen>parseInt(config.maximumTitleLength,10))return F(e,"[[error:title-too-long, "+config.maximumTitleLength+"]]");if(P==="topics.post"&&!M)return F(e,"[[error:category-not-selected]]");if(W.bodyLen<parseInt(config.minimumPostLength,10))return F(e,"[[error:content-too-short, "+config.minimumPostLength+"]]");if(W.bodyLen>parseInt(config.maximumPostLength,10))return F(e,"[[error:content-too-long, "+config.maximumPostLength+"]]");if(R&&!b.isEnoughTags(e))return F(e,"[[error:not-enough-tags, "+b.minTagCount()+"]]");if(n.isActive()&&n.getTimestamp()<=Date.now())return F(e,"[[error:scheduling-to-past]]");let B={uuid:e},Y="post",K="";P==="topics.post"?(K="/topics",B={...B,handle:p?p.val():void 0,title:w.val(),content:C.val(),thumb:T.val()||"",cid:a.getSelectedCid(),tags:b.getTags(e),timestamp:n.getTimestamp()}):P==="posts.reply"?(K=`/topics/${t.tid}`,B={...B,tid:t.tid,handle:p?p.val():void 0,content:C.val(),toPid:t.toPid}):P==="posts.edit"&&(Y="put",K=`/posts/${t.pid}`,B={...B,pid:t.pid,handle:p?p.val():void 0,content:C.val(),title:w.val(),thumb:T.val()||"",tags:b.getTags(e),timestamp:n.getTimestamp()});var V={composerEl:l,action:P,composerData:B,postData:t,redirect:!0};await E.fire("filter:composer.submit",V),E.fire("action:composer.submit",Object.freeze(V));var re=$('#taskbar .composer[data-uuid="'+e+'"] i'),ie=l.find(".write");re.removeClass("fa-plus").addClass("fa-circle-o-notch fa-spin"),i.minimize(e),ie.prop("readonly",!0),h[Y](K,B).then(z=>{U.removeAttr("disabled"),t.submitted=!0,i.discard(e),c.removeDraft(t.save_id),z.queued?O.alert({type:"success",title:"[[global:alert.success]]",message:z.message,timeout:1e4,clickfn:function(){ajaxify.go(`/post-queue/${z.id}`)}}):P==="topics.post"?V.redirect&&ajaxify.go("topic/"+z.slug,void 0,N||i.bsEnvironment==="xs"||i.bsEnvironment==="sm"):P==="posts.reply"?N||i.bsEnvironment==="xs"||i.bsEnvironment==="sm"?window.history.back():V.redirect&&(ajaxify.data.template.name!=="topic"||ajaxify.data.template.topic&&parseInt(t.tid,10)!==parseInt(ajaxify.data.tid,10))&&ajaxify.go("post/"+z.pid):j(),E.fire("action:composer."+P,{composerData:B,data:z})}).catch(z=>{if(i.load(e),ie.prop("readonly",!1),z.message==="[[error:email-not-confirmed]]")return k.showEmailConfirmWarning(z.message);F(e,z.message)})}function ee(){$("html").addClass("composing")}function te(){$("body").css({paddingBottom:0}),$("html").removeClass("composing"),app.toggleNavbar(!0)}return i.discard=function(e){if(i.posts[e]){var t=i.posts[e],l=$('.composer[data-uuid="'+e+'"]');l.remove(),c.removeDraft(t.save_id),x.deleteAll(e),v.discard("composer",e),$('[data-action="post"]').removeAttr("disabled"),E.fire("action:composer.discard",{post_uuid:e,postData:t}),delete i.posts[e],i.active=void 0}n.reset(),te()},i.close=i.discard,i.minimize=function(e){var t=$('.composer[data-uuid="'+e+'"]');t.css("visibility","hidden"),i.active=void 0,v.minimize("composer",e),$(window).trigger("action:composer.minimize",{post_uuid:e}),te()},i.minimizeActive=function(){i.active&&i.miminize(i.active)},i.updateThumbCount=function(e,t){const l=i.posts[e];if(l.action==="topics.post"||l.action==="posts.edit"&&l.isMain){const p=[x.get(e)];l.pid&&p.push(x.getByPid(l.pid)),Promise.all(p).then(w=>{w=w.reduce((C,T)=>(C=C.concat(T),C)),w.length&&t.find('[data-format="thumbs"]').attr("data-count",w.length)})}},i}.apply(D,I),y!==void 0&&(L.exports=y)},2585:(L,D,d)=>{var I,y;I=[d(83713),d(70675),d(88207),d(62336)],y=function(v,{Textcomplete:g},{TextareaEditor:m},{ContenteditableEditor:u}){var c={_active:{}};return $(window).on("action:composer.discard",function(b,a){c._active.hasOwnProperty(a.post_uuid)&&(c._active[a.post_uuid].destroy(),delete c._active[a.post_uuid])}),c.init=function(b,a){var s=b.find(".write"),r="composer-autocomplete-dropdown-"+a,o;if(s.length){var n={element:s,strategies:[],options:{style:{"z-index":2e4},className:r+" dropdown-menu textcomplete-dropdown"}};s.on("keyup",function(){clearTimeout(o),o=setTimeout(function(){var f=document.querySelector("."+r);if(f){var x=f.getBoundingClientRect(),h=parseFloat(f.style.marginTop,10)||0,S=window.innerHeight+h-10-x.bottom;f.style.marginTop=Math.min(S,0)+"px"}},0)}),$(window).trigger("composer:autocomplete:init",n),c._active[a]=c.setup(n),n.element.on("textComplete:select",function(){v.render(b)})}},c.setup=function({element:b,strategies:a,options:s}){const r=b.get(0);if(r){var o;r.nodeName==="TEXTAREA"?o=new m(r):r.nodeName==="DIV"&&r.getAttribute("contenteditable")==="true"&&(o=new u(r)),r.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var n=new g(o,a,{dropdown:s});return n.on("rendered",function(){n.dropdown.items.length&&n.dropdown.items[0].activate()}),n}},c}.apply(D,I),y!==void 0&&(L.exports=y)},98166:(L,D,d)=>{var I,y;I=[d(59006),d(31369),d(7927)],y=function(v,g,m){const u={},c={timestamp:0,open:!1,edit:!1,posts:{}};let b=[],a;const s={el:null,icon:null,defaultText:"",activeText:""};let r,o;$(window).on("action:composer.activate",h),u.init=function(A,i){c.timestamp=0,c.posts=i,b=A[0].querySelectorAll(".display-scheduler"),a=A[0].querySelectorAll(".display-scheduler i"),s.el=A[0].querySelector(".composer-submit:not(.btn-sm)"),s.icon=s.el.querySelector("i"),s.defaultText=s.el.lastChild.textContent,s.activeText=s.el.getAttribute("data-text-variant"),a.forEach(j=>j.addEventListener("click",n))},u.getTimestamp=function(){return!u.isActive()||isNaN(c.timestamp)?0:c.timestamp},u.isActive=function(){return c.timestamp>0},u.isOpen=function(){return c.open},u.reset=function(){c.timestamp=0},u.onChangeCategory=function(A){H(A.privileges["topics:schedule"]),k(!1),u.reset()};async function n(){const A=await v.render("modals/topic-scheduler");g.dialog({message:A,title:"[[modules:composer.schedule-for]]",className:"topic-scheduler",onShown:f,onHidden:x,onEscape:!0,buttons:{cancel:{label:c.timestamp?"[[modules:composer.cancel-scheduling]]":"[[modules:bootbox.cancel]]",className:(c.timestamp?"btn-warning":"btn-default")+(c.edit?" hidden":""),callback:E},set:{label:"[[modules:composer.set-schedule-date]]",className:"btn-primary",callback:O}}})}function f(A){c.open=!0;const i=A.target.querySelector(".datetime-picker");r=i.querySelector('input[type="date"]'),o=i.querySelector('input[type="time"]'),S()}function x(){c.open=!1}function h(A,{post_uuid:i}){c.edit=!1;const j=c.posts[i];j&&j.isMain&&j.timestamp>Date.now()&&(c.timestamp=j.timestamp,c.edit=!0,k())}function S(){const A=new Date,i=new Date(A.getTime()-A.getTimezoneOffset()*6e4).toJSON();if(r.setAttribute("min",i.slice(0,10)),o.setAttribute("min",i.slice(11,-8)),u.isActive()){const j=new Date(c.timestamp-A.getTimezoneOffset()*6e4).toJSON();r.value=j.slice(0,10),o.value=j.slice(11,-8)}}function O(){const A=r.value&&o.value,i=new Date(`${r.value} ${o.value}`).getTime();if(!A||isNaN(i)||i<Date.now()){c.timestamp=0;const j=i<Date.now()?"[[error:scheduling-to-past]]":"[[error:invalid-schedule-date]]";return m.alert({type:"danger",timeout:3e3,title:"",alert_id:"post_error",message:j}),!1}c.timestamp||k(!0),c.timestamp=i}function E(){c.timestamp&&(k(!1),c.timestamp=0)}function k(A=!0){a.forEach(i=>i.classList.toggle("active",A)),s.icon&&(s.icon.classList.toggle("fa-check",!A),s.icon.classList.toggle("fa-clock-o",A)),s.el.lastChild.textContent=A?s.activeText:s.defaultText}function H(A){b.forEach(i=>i.classList.toggle("hidden",!A))}return u}.apply(D,I),y!==void 0&&(L.exports=y)},88186:(L,D,d)=>{var I,y;I=[d(7927)],y=function(v){var g={},m,u;g.init=function(s,r){var o=s.find(".tags");if(o.length){m=ajaxify.data.hasOwnProperty("minTags")?ajaxify.data.minTags:config.minimumTagsPerTopic,u=ajaxify.data.hasOwnProperty("maxTags")?ajaxify.data.maxTags:config.maximumTagsPerTopic,o.tagsinput({confirmKeys:[13,44],trimValue:!0});var n=s.find(".bootstrap-tagsinput input");c(s,r,ajaxify.data),app.loadJQueryUI(function(){n.autocomplete({delay:100,position:{my:"left bottom",at:"left top",collision:"flip"},appendTo:s.find(".bootstrap-tagsinput"),open:function(){$(this).autocomplete("widget").css("z-index",2e4)},source:function(h,S){socket.emit("topics.autocompleteTags",{query:h.term,cid:r.cid},function(O,E){if(O)return v.error(O);E&&S(E),$(".ui-autocomplete a").attr("data-ajaxify","false")})},select:function(){b(n)}}),a(r.tags,o),o.on("beforeItemAdd",function(h){var S=u&&u<=g.getTags(s.attr("data-uuid")).length,O=utils.cleanUpTag(h.item,config.maximumTagLength),E=O!==h.item;if(h.cancel=E||h.item.length<config.minimumTagLength||h.item.length>config.maximumTagLength||S,h.item.length<config.minimumTagLength)return v.error("[[error:tag-too-short, "+config.minimumTagLength+"]]");if(h.item.length>config.maximumTagLength)return v.error("[[error:tag-too-long, "+config.maximumTagLength+"]]");if(S)return v.error("[[error:too-many-tags, "+u+"]]");E&&o.tagsinput("add",O)});var f=!1,x=!1;o.on("itemRemoved",function(h){if(x){x=!1;return}h.item&&socket.emit("topics.canRemoveTag",{tag:h.item},function(S,O){if(S)return v.error(S);O||(v.error("[[error:cant-remove-system-tag]]"),f=!0,o.tagsinput("add",h.item))})}),o.on("itemAdded",function(h){if(f){f=!1;return}var S=r.hasOwnProperty("cid")?r.cid:ajaxify.data.cid;socket.emit("topics.isTagAllowed",{tag:h.item,cid:S||0},function(O,E){if(O)return v.error(O);if(!E)return x=!0,o.tagsinput("remove",h.item);$(window).trigger("action:tag.added",{cid:S,tagEl:o,tag:h.item}),n.length&&n.autocomplete("close")})})}),n.attr("tabIndex",o.attr("tabIndex")),n.on("blur",function(){b(n)}),$('[component="composer/tag/dropdown"]').on("click","li",function(){var f=$(this).attr("data-tag");return f&&a([f],o),!1})}},g.isEnoughTags=function(s){return g.getTags(s).length>=m},g.minTagCount=function(){return m},g.onChangeCategory=function(s,r,o,n){var f=s.find('[component="composer/tag/dropdown"]');f.length&&(c(s,r,n),f.toggleClass("hidden",!n.tagWhitelist||!n.tagWhitelist.length),n.tagWhitelist&&app.parseAndTranslate("composer","tagWhitelist",{tagWhitelist:n.tagWhitelist},function(x){f.find(".dropdown-menu").html(x)}))};function c(s,r,o){var n=s.find(".tags"),f=s.find(".bootstrap-tagsinput input");f.length&&(o.hasOwnProperty("minTags")&&(m=o.minTags),o.hasOwnProperty("maxTags")&&(u=o.maxTags),o.tagWhitelist&&o.tagWhitelist.length?(f.attr("readonly",""),f.attr("placeholder",""),n.tagsinput("items").slice().forEach(function(x){o.tagWhitelist.indexOf(x)===-1&&n.tagsinput("remove",x)})):(f.removeAttr("readonly"),f.attr("placeholder",s.find("input.tags").attr("placeholder"))),s.find(".tags-container").toggleClass("hidden",o.privileges&&o.privileges.hasOwnProperty("topics:tag")&&!o.privileges["topics:tag"]||u===0&&!r&&!r.tags&&!r.tags.length),o.privileges&&o.privileges.hasOwnProperty("topics:tag")&&!o.privileges["topics:tag"]&&n.tagsinput("removeAll"),$(window).trigger("action:tag.toggleInput",{postContainer:s,tagWhitelist:o.tagWhitelist,tagsInput:f}))}function b(s){var r=jQuery.Event("keypress");r.which=13,r.keyCode=13,setTimeout(function(){s.trigger(r)},100)}function a(s,r){if(s&&s.length)for(var o=0;o<s.length;++o)r.tagsinput("add",s[o])}return g.getTags=function(s){return $('.composer[data-uuid="'+s+'"] .tags').tagsinput("items")},g}.apply(D,I),y!==void 0&&(L.exports=y)},44882:(L,D,d)=>{var I,y;I=[d(31369),d(32230),d(66603),d(7927),d(85233)],y=function(v,g,m,u,c){const b={};let a,s;b.show=function(){c.one("action:ajaxify.end",()=>{o(),r(),b.showEmailConfirmWarning()})},b.showEmailConfirmWarning=function(n){if(!config.emailPrompt||!app.user.uid||parseInt(m.getItem("email-confirm-dismiss"),10)===1)return;const f={alert_id:"email_confirm",type:"warning",timeout:0,closefn:()=>{m.setItem("email-confirm-dismiss",1)}};app.user.email?!app.user["email:confirmed"]&&!app.user.isEmailConfirmSent?(f.message=n||"[[error:email-not-confirmed]]",f.clickfn=function(){u.remove("email_confirm"),ajaxify.go("/me/edit/email")},u.alert(f)):!app.user["email:confirmed"]&&app.user.isEmailConfirmSent&&(f.message="[[error:email-not-confirmed-email-sent]]",u.alert(f)):(f.message="[[error:no-email-to-confirm]]",f.clickfn=function(){u.remove("email_confirm"),ajaxify.go("user/"+app.user.userslug+"/edit/email")},u.alert(f))};function r(){!config.cookies.enabled||!navigator.cookieEnabled||app.inAdmin||m.getItem("cookieconsent")==="1"||(config.cookies.message=g.unescape(config.cookies.message),config.cookies.dismiss=g.unescape(config.cookies.dismiss),config.cookies.link=g.unescape(config.cookies.link),config.cookies.link_url=g.unescape(config.cookies.link_url),app.parseAndTranslate("partials/cookie-consent",config.cookies,function(n){$(document.body).append(n),$(document.body).addClass("cookie-consent-open");const f=$(".cookie-consent");f.find("button").on("click",function(){m.setItem("cookieconsent","1"),f.remove(),$(document.body).removeClass("cookie-consent-open")})}))}function o(){const n=utils.params({full:!0});a=n.has("loggedin"),s=n.get("register"),a&&(u.alert({type:"success",title:"[[global:welcome_back]] "+app.user.username+"!",message:"[[global:you_have_successfully_logged_in]]",timeout:5e3}),n.delete("loggedin")),s&&(v.alert({message:utils.escapeHTML(decodeURIComponent(s))}),n.delete("register")),n.has("lang")&&n.get("lang")===config.defaultLang&&(console.info(`The "lang" parameter was passed in to set the language to "${n.get("lang")}", but that is already the forum default language.`),n.delete("lang"));const f=n.toString();ajaxify.updateHistory(ajaxify.currentPage+(f?`?${f}`:"")+document.location.hash,!0)}return b.showInvalidSession=function(){v.alert({title:"[[error:invalid-session]]",message:"[[error:invalid-session-text]]",closeButton:!1,callback:function(){window.location.reload()}})},b.showSessionMismatch=function(){v.alert({title:"[[error:session-mismatch]]",message:"[[error:session-mismatch-text]]",closeButton:!1,callback:function(){window.location.reload()}})},b}.apply(D,I),y!==void 0&&(L.exports=y)},75203:(L,D,d)=>{var I;I=function(){const y={};return y.apply=function(v){$(v).on("mousewheel",function(g){const m=this.scrollTop,u=this.scrollHeight,c=Math.round(this.getBoundingClientRect().height);if(g.originalEvent.deltaY<0&&m===0||g.originalEvent.deltaY>0&&c+m>=u)return!1})},y}.call(D,d,D,L),I!==void 0&&(L.exports=I)},7073:(L,D,d)=>{var I,y;I=[d(32230),d(66603),d(85233),d(7927)],y=function(v,g,m,u){const c={current:{}};c.init=function(a){if(!config.searchEnabled)return;a=a||{in:config.searchDefaultInQuick||"titles"};const s=$("#search-button"),r=$("#search-fields"),o=$("#search-fields input"),n=$("#quick-search-container");$("#search-form .advanced-search-link").off("mousedown").on("mousedown",function(){ajaxify.go("/search")}),$("#search-form").off("submit").on("submit",function(){o.blur()}),o.off("blur").on("blur",function(){setTimeout(function(){o.is(":focus")||(r.addClass("hidden"),s.removeClass("hidden"))},200)}),o.off("focus");const f={inputEl:o,resultEl:n};c.enableQuickSearch({searchOptions:a,searchElements:f}),s.off("click").on("click",function(x){return!config.loggedIn&&!app.user.privileges["search:content"]?(u.alert({message:"[[error:search-requires-login]]",timeout:3e3}),ajaxify.go("login"),!1):(x.stopPropagation(),c.showAndFocusInput(),!1)}),$("#search-form").off("submit").on("submit",function(){const x=$(this).find("input"),h=c.getSearchPreferences();return h.term=x.val(),h.in=a.in,m.fire("action:search.submit",{searchOptions:h,searchElements:f}),c.query(h,function(){x.val("")}),!1})},c.enableQuickSearch=function(a){if(!config.searchEnabled||!app.user.privileges["search:content"])return;const s=Object.assign({in:config.searchDefaultInQuick||"titles"},a.searchOptions),r=a.searchElements.resultEl,o=a.searchElements.inputEl;let n=o.val();const f=r.find(".filter-category");function x(){ajaxify.data.template.category&&ajaxify.data.cid&&v.translate("[[search:search-in-category, "+ajaxify.data.name+"]]",function(E){const k=$("<div></div>").html(E).text();f.find(".name").text(k)}),f.toggleClass("hidden",!(ajaxify.data.template.category&&ajaxify.data.cid))}function h(){a.searchOptions=Object.assign({},s),a.searchOptions.term=o.val(),x(),ajaxify.data.template.category&&ajaxify.data.cid&&f.find('input[type="checkbox"]').is(":checked")&&(a.searchOptions.categories=[ajaxify.data.cid],a.searchOptions.searchChildren=!0),r.removeClass("hidden").find(".quick-search-results-container").html(""),r.find(".loading-indicator").removeClass("hidden"),m.fire("action:search.quick.start",a),a.searchOptions.searchOnly=1,c.api(a.searchOptions,function(E){if(r.find(".loading-indicator").addClass("hidden"),!E.posts||a.hideOnNoMatches&&!E.posts.length)return r.addClass("hidden").find(".quick-search-results-container").html("");E.posts.forEach(function(k){const H=$("<div>"+k.content+"</div>").text(),A=o.val().toLowerCase().replace(/^in:topic-\d+/,""),i=Math.max(0,H.toLowerCase().indexOf(A)-40);k.snippet=utils.escapeHTML((i>0?"...":"")+H.slice(i,i+80)+(H.length-i>80?"...":""))}),app.parseAndTranslate("partials/quick-search-results",E,function(k){k.length&&k.find(".timeago").timeago(),r.toggleClass("hidden",!k.length||!o.is(":focus")).find(".quick-search-results-container").html(k.length?k:"");const H=r.find(".quick-search-results .quick-search-title, .quick-search-results .snippet");c.highlightMatches(a.searchOptions.term,H),m.fire("action:search.quick.complete",{data:E,options:a})})})}r.find('.filter-category input[type="checkbox"]').on("change",function(){o.focus(),h()}),o.off("keyup").on("keyup",utils.debounce(function(){if(o.val().length<3){r.addClass("hidden"),n=o.val();return}if(o.val()!==n){if(n=o.val(),!o.is(":focus"))return r.addClass("hidden");h()}},500));let S=!1;r.on("mousedown",function(){$(window).one("mouseup",function(){r.addClass("hidden")}),S=!0}),o.on("blur",function(){!o.is(":focus")&&!S&&!r.hasClass("hidden")&&r.addClass("hidden")});let O=!1;m.on("action:ajaxify.end",function(){ajaxify.isCold()||(O=!0)}),o.on("focus",function(){S=!1;const E=o.val();n=E,E&&r.find("#quick-search-results").children().length&&(x(),O?(h(),O=!1):r.removeClass("hidden"),o[0].setSelectionRange(E.startsWith("in:topic")?E.indexOf(" ")+1:0,E.length))}),o.off("refresh").on("refresh",function(){h()})},c.showAndFocusInput=function(){$("#search-fields").removeClass("hidden"),$("#search-button").addClass("hidden"),$("#search-fields input").focus()},c.query=function(a,s){s=s||function(){},ajaxify.go("search?"+b(a)),s()},c.api=function(a,s){const r=config.relative_path+"/api/search?"+b(a);a.searchOnly=void 0;const o=config.relative_path+"/search?"+b(a);$.get(r,function(n){n.url=o,s(n)})};function b(a){const s=a.in||"titles",r=a.by||"";let o=a.term.replace(/^[ ?#]*/,"");try{o=encodeURIComponent(o)}catch{return u.error("[[error:invalid-search-term]]")}const n={term:o,in:s};return a.matchWords&&(n.matchWords=a.matchWords),r&&r.length&&(s==="posts"||s==="titles"||s==="titlesposts")&&(n.by=r),a.categories&&a.categories.length&&(n.categories=a.categories,a.searchChildren&&(n.searchChildren=a.searchChildren)),a.hasTags&&a.hasTags.length&&(n.hasTags=a.hasTags),parseInt(a.replies,10)>0&&(n.replies=a.replies,n.repliesFilter=a.repliesFilter||"atleast"),a.timeRange&&(n.timeRange=a.timeRange,n.timeFilter=a.timeFilter||"newer"),a.sortBy&&(n.sortBy=a.sortBy,n.sortDirection=a.sortDirection),a.showAs&&(n.showAs=a.showAs),a.searchOnly&&(n.searchOnly=a.searchOnly),m.fire("action:search.createQueryString",{query:n,data:a}),decodeURIComponent($.param(n))}return c.getSearchPreferences=function(){try{return JSON.parse(g.getItem("search-preferences")||"{}")}catch{return{}}},c.highlightMatches=function(a,s){if(!a||!s.length)return;a=utils.escapeHTML(a.replace(/^"/,"").replace(/"$/,"").trim());const r=a.split(" ").map(function(n){return utils.escapeRegexChars(n)}).join("|"),o=new RegExp("("+r+")","gi");s.each(function(){const n=$(this),f=[];n.find("*").each(function(){$(this).after("<!-- "+f.length+" -->"),f.push($("<div></div>").append($(this)))}),n.html(n.html().replace(o,function(x,h){return'<strong class="search-match">'+h+"</strong>"})),f.forEach(function(x,h){n.html(n.html().replace("<!-- "+h+" -->",function(){return x.html()}))})}),$(".search-result-text").find("img:not(.not-responsive)").addClass("img-responsive")},c}.apply(D,I),y!==void 0&&(L.exports=y)},66603:(L,D,d)=>{var I;I=function(){function y(){this._store={},this._keys=[]}y.prototype.isMock=!0,y.prototype.setItem=function(m,u){m=String(m),this._keys.indexOf(m)===-1&&this._keys.push(m),this._store[m]=u},y.prototype.getItem=function(m){return m=String(m),this._keys.indexOf(m)===-1?null:this._store[m]},y.prototype.removeItem=function(m){m=String(m),this._keys=this._keys.filter(function(u){return u!==m}),this._store[m]=null},y.prototype.clear=function(){this._keys=[],this._store={}},y.prototype.key=function(m){return m=parseInt(m,10)||0,this._keys[m]},Object.defineProperty&&Object.defineProperty(y.prototype,"length",{get:function(){return this._keys.length}});let v;const g=Date.now().toString();try{if(v=window.localStorage,v.setItem(g,g),v.getItem(g)!==g)throw Error("localStorage behaved unexpectedly");return v.removeItem(g),v}catch(m){console.warn(m),console.warn("localStorage failed, falling back on sessionStorage");try{if(v=window.sessionStorage,v.setItem(g,g),v.getItem(g)!==g)throw Error("sessionStorage behaved unexpectedly");return v.removeItem(g),v}catch(u){return console.warn(u),console.warn("sessionStorage failed, falling back on memory storage"),new y}}}.call(D,d,D,L),I!==void 0&&(L.exports=I)}}]);
